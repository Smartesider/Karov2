{% extends "core/base.html" %}
{% load static %}

{% block title %}Betaling fullført - JuridiskPorten{% endblock %}

{% block extra_head %}
<style>
.success-container {
    min-height: 70vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.success-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    text-align: center;
    max-width: 600px;
    width: 100%;
}

.success-icon {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #28a745, #20c997);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 2rem;
    animation: checkmark 0.6s ease-in-out;
}

@keyframes checkmark {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    50% {
        transform: scale(1.2);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

.order-details {
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #28a745;
}

.package-list {
    background: linear-gradient(135deg, #3E4D50, #A7B9BC);
    color: white;
    border-radius: 8px;
}

.btn-dashboard {
    background: linear-gradient(135deg, #D3B16D, #b8965a);
    border: none;
    color: white;
    font-weight: bold;
    padding: 12px 30px;
    border-radius: 25px;
    transition: all 0.3s ease;
}

.btn-dashboard:hover {
    background: linear-gradient(135deg, #b8965a, #9a7a47);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(211, 177, 109, 0.4);
}

.next-steps {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    border-radius: 8px;
    border-left: 4px solid #2196f3;
}

.feature-highlight {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.feature-highlight:hover {
    transform: translateY(-5px);
}
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="success-container">
        <div class="success-card p-5">
            <!-- Success Icon -->
            <div class="success-icon">
                <i class="fas fa-check fa-3x text-white"></i>
            </div>

            <!-- Success Message -->
            <h1 class="mb-3" style="color: #28a745;">Takk for ditt kjøp!</h1>
            <p class="lead text-muted mb-4">
                Din bestilling er bekreftet og betalingen er fullført. 
                Du har nå tilgang til alle kjøpte fagpakker.
            </p>

            {% if order %}
            <!-- Order Details -->
            <div class="order-details p-4 mb-4">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-receipt me-2"></i>Bestillingsnummer</h6>
                        <p class="fw-bold">{{ order.order_number }}</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-calendar me-2"></i>Kjøpsdato</h6>
                        <p>{{ order.created_at|date:"d. F Y, H:i" }}</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-envelope me-2"></i>Kvittering sendt til</h6>
                        <p>{{ order.billing_email }}</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-credit-card me-2"></i>Beløp betalt</h6>
                        <p class="fw-bold">{{ order.final_amount|floatformat:0 }} kr</p>
                    </div>
                </div>
            </div>

            <!-- Purchased Packages -->
            <div class="package-list p-4 mb-4">
                <h5 class="mb-3">
                    <i class="fas fa-box-open me-2"></i>Dine nye fagpakker
                </h5>
                {% for item in order.items.all %}
                <div class="d-flex justify-content-between align-items-center py-2 {% if not forloop.last %}border-bottom border-light{% endif %}">
                    <div>
                        <strong>{{ item.package.name }}</strong>
                        <br>
                        <small class="text-light">
                            <i class="fas fa-clock me-1"></i>{{ item.package.trial_period_days }} dagers prøveperiode
                        </small>
                    </div>
                    <div class="text-end">
                        <span class="fw-bold">{{ item.total_price|floatformat:0 }} kr</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Next Steps -->
            <div class="next-steps p-4 mb-4">
                <h5 class="mb-3">
                    <i class="fas fa-arrow-right me-2"></i>Hva skjer nå?
                </h5>
                <div class="row text-start">
                    <div class="col-md-6 mb-3">
                        <div class="d-flex">
                            <div class="me-3">
                                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">
                                    <small class="text-white fw-bold">1</small>
                                </div>
                            </div>
                            <div>
                                <strong>Umiddelbar tilgang</strong>
                                <p class="small mb-0">Du kan begynne å bruke fagpakkene dine med en gang</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex">
                            <div class="me-3">
                                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">
                                    <small class="text-white fw-bold">2</small>
                                </div>
                            </div>
                            <div>
                                <strong>E-post kvittering</strong>
                                <p class="small mb-0">Vi har sendt en kvittering til {{ order.billing_email|default:"din e-post" }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex">
                            <div class="me-3">
                                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">
                                    <small class="text-white fw-bold">3</small>
                                </div>
                            </div>
                            <div>
                                <strong>Prøveperiode</strong>
                                <p class="small mb-0">Du har full tilgang med {{ order.items.first.package.trial_period_days|default:"7" }} dagers prøveperiode</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="d-flex">
                            <div class="me-3">
                                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 30px; height: 30px;">
                                    <small class="text-white fw-bold">4</small>
                                </div>
                            </div>
                            <div>
                                <strong>Support tilgjengelig</strong>
                                <p class="small mb-0">Vårt team er klare til å hjelpe deg komme i gang</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-4">
                <a href="{% url 'core:dashboard' %}" class="btn btn-dashboard btn-lg">
                    <i class="fas fa-home me-2"></i>Gå til dashboard
                </a>
                <a href="{% url 'core:package_list' %}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-book me-2"></i>Utforsk innhold
                </a>
            </div>

            <!-- Additional Links -->
            <div class="text-center">
                <p class="small text-muted mb-2">
                    Trenger du hjelp? 
                    <a href="mailto:support@juridiskporten.no">Kontakt kundeservice</a>
                </p>
                {% if order %}
                <p class="small text-muted">
                    <a href="{% url 'core:order_detail' order.id %}">Se fullstendig bestillingsdetajer</a>
                </p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Feature Highlights -->
    <div class="row mt-5 mb-5">
        <div class="col-12">
            <h3 class="text-center mb-4" style="color: #3E4D50;">
                Hva kan du gjøre nå?
            </h3>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="feature-highlight p-4 h-100">
                <div class="text-center">
                    <i class="fas fa-book-open fa-3x text-primary mb-3"></i>
                    <h5>Les artikler</h5>
                    <p class="text-muted">
                        Utforsk juridiske artikler, guider og oppdateringer 
                        skreddersydd for dine fagområder.
                    </p>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="feature-highlight p-4 h-100">
                <div class="text-center">
                    <i class="fas fa-file-download fa-3x text-success mb-3"></i>
                    <h5>Last ned skjemaer</h5>
                    <p class="text-muted">
                        Få tilgang til juridiske skjemaer, maler og 
                        dokumenter klare til bruk.
                    </p>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="feature-highlight p-4 h-100">
                <div class="text-center">
                    <i class="fas fa-robot fa-3x text-warning mb-3"></i>
                    <h5>Spør AI-assistenten</h5>
                    <p class="text-muted">
                        Få øyeblikkelige svar på juridiske spørsmål 
                        fra vår pakke-spesifikke AI.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Track successful purchase for analytics
if (typeof gtag !== 'undefined') {
    gtag('event', 'purchase', {
        'transaction_id': '{{ order.order_number }}',
        'value': {{ order.final_amount|default:0 }},
        'currency': 'NOK',
        'items': [
            {% for item in order.items.all %}
            {
                'item_id': '{{ item.package.slug }}',
                'item_name': '{{ item.package.name }}',
                'category': 'Legal Package',
                'quantity': {{ item.quantity }},
                'price': {{ item.price }}
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]
    });
}

// Auto-redirect to dashboard after 30 seconds
setTimeout(function() {
    if (confirm('Vil du bli omdirigert til dashboard?')) {
        window.location.href = "{% url 'core:dashboard' %}";
    }
}, 30000);

// Clear any cart data from localStorage
localStorage.removeItem('cart');
sessionStorage.removeItem('pendingOrder');
</script>
{% endblock %}
